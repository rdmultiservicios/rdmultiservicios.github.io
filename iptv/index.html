<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPTV - Diseño Tipo Movistar TV</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10"></script>
  <script src="https://cdn.jsdelivr.net/npm/m3u-parser-generator@5.0.1/dist/m3u-parser-generator.iife.js"></script>

  <style>
    body {
      background-color: #121212;
      color: #fff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h2 {
      color: #00a0e9;
      font-weight: 700;
      letter-spacing: 1px;
      text-align: center;
      margin-bottom: 2rem;
    }

    /* Inputs y botones */
    input.form-control, 
    .btn {
      border-radius: 8px;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }

    input.form-control:focus {
      box-shadow: 0 0 8px #00a0e9;
      border-color: #00a0e9;
      background-color: #1e1e1e;
      color: #fff;
    }

    .btn-primary {
      background-color: #00a0e9;
      border: none;
    }

    .btn-primary:hover {
      background-color: #007bbf;
    }

    .btn-outline-warning {
      color: #ffc107;
      border-color: #ffc107;
      font-weight: 600;
    }

    .btn-outline-warning.active,
    .btn-outline-warning:hover {
      background-color: #ffc107;
      color: #121212;
      border-color: #ffc107;
    }

    /* Lista de canales como cards */
    #channelList {
      max-height: 65vh;
      overflow-y: auto;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 15px;
    }

    .channel-card {
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      user-select: none;
    }

    .channel-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0,160,233,0.8);
    }

    .channel-card.active {
      border: 3px solid #00a0e9;
      box-shadow: 0 6px 20px rgba(0,160,233,1);
      transform: scale(1.1);
      background-color: #121212;
    }

    .channel-logo {
      max-width: 90px;
      max-height: 90px;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 2px #00a0e9);
    }

    .channel-name {
      font-weight: 700;
      font-size: 1rem;
      text-align: center;
      color: #e0e0e0;
      flex-grow: 1;
      user-select: none;
    }

    /* Contenedor video */
    .video-container {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.8);
      background-color: black;
    }

    video#videoPlayer {
      border-radius: 15px;
      background-color: black;
      width: 100%;
      height: 100%;
    }

    /* Info canal y botón favorito */
    #channelInfo {
      text-align: center;
      margin-top: 15px;
    }

    #channelName {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
      color: #00a0e9;
    }

    #channelGroup {
      font-style: italic;
      color: #bbb;
      margin-bottom: 10px;
    }

    #channelLogo.big {
      max-height: 120px;
      margin: 0 auto 15px;
      display: block;
      filter: drop-shadow(0 0 6px #00a0e9);
    }

    #favBtn {
      font-size: 1.3rem;
      font-weight: 700;
      padding: 10px 25px;
      border-radius: 30px;
      border: 2px solid #ffc107;
      color: #ffc107;
      background: transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
    }

    #favBtn:hover {
      background-color: #ffc107;
      color: #121212;
    }

    /* Scrollbar personalizado para canales */
    #channelList::-webkit-scrollbar {
      width: 8px;
    }
    #channelList::-webkit-scrollbar-track {
      background: #121212;
    }
    #channelList::-webkit-scrollbar-thumb {
      background-color: #00a0e9;
      border-radius: 10px;
    }

    /* Responsive */
    @media (max-width: 767.98px) {
      #channelList {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        max-height: 50vh;
        margin-bottom: 20px;
      }

      #channelName {
        font-size: 1.5rem;
      }

      #favBtn {
        width: 100%;
        padding: 12px 0;
      }
    }
  </style>
</head>
<body>

<div class="container-fluid py-4">
  <h2>IPTV - Diseño Moderno Tipo Movistar TV</h2>

  <!-- Carga de lista -->
  <div class="row gy-3 mb-4">
    <div class="col-12 col-md-6">
      <input id="m3uInput" type="file" class="form-control" accept=".m3u,.txt" />
    </div>
    <div class="col-12 col-md-6">
      <div class="input-group">
        <input id="m3uUrl" type="url" class="form-control" placeholder="URL de lista M3U" />
        <button id="loadUrlBtn" class="btn btn-primary">Cargar</button>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="row gy-3 mb-4">
    <div class="col-12 col-md-6">
      <input id="searchInput" type="text" class="form-control" placeholder="Buscar canal..." />
    </div>
    <div class="col-12 col-md-6">
      <button id="favFilterBtn" class="btn btn-outline-warning w-100">Mostrar solo favoritos</button>
    </div>
  </div>

  <!-- Layout flexible -->
  <div class="row flex-column flex-lg-row">
    <!-- Lista de canales -->
    <div class="col-12 col-lg-4 mb-4 mb-lg-0">
      <div id="channelList"></div>
    </div>

    <!-- Reproductor y detalles -->
    <div class="col-12 col-lg-8">
      <div class="video-container ratio ratio-16x9 mb-3">
        <video id="videoPlayer" controls autoplay></video>
      </div>
      <div id="channelInfo">
        <h3 id="channelName"></h3>
        <img id="channelLogo" src="" alt="" class="big" />
        <div id="channelGroup"></div>
        <button id="favBtn">♥ Favorito</button>
      </div>
    </div>
  </div>
</div>

<script>
  const parser = new m3uParserGenerator.M3uParser();
  let allChannels = [];
  let filteredChannels = [];
  let currentHls = null;
  let favorites = new Set(JSON.parse(localStorage.getItem("favorites") || "[]"));
  let activeChannelId = null;

  const m3uInput = document.getElementById("m3uInput");
  const m3uUrl = document.getElementById("m3uUrl");
  const loadUrlBtn = document.getElementById("loadUrlBtn");
  const channelList = document.getElementById("channelList");
  const searchInput = document.getElementById("searchInput");
  const favFilterBtn = document.getElementById("favFilterBtn");
  const videoPlayer = document.getElementById("videoPlayer");
  const channelName = document.getElementById("channelName");
  const channelLogo = document.getElementById("channelLogo");
  const channelGroup = document.getElementById("channelGroup");
  const favBtn = document.getElementById("favBtn");

  m3uInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => loadPlaylist(e.target.result);
    reader.readAsText(file);
  });

  loadUrlBtn.addEventListener("click", () => {
    const url = m3uUrl.value.trim();
    if (!url) return;
    fetch(url)
      .then((r) => r.text())
      .then(loadPlaylist)
      .catch(() => alert("Error al cargar lista"));
  });

  searchInput.addEventListener("input", renderList);

  favFilterBtn.addEventListener("click", () => {
    favFilterBtn.classList.toggle("active");
    renderList();
  });

  function loadPlaylist(text) {
    const pl = parser.parse(text);
    allChannels = pl.medias.map((m) => ({
      name: m.name,
      url: m.location,
      logo: m.attributes["tvg-logo"] || "",
      group: m.attributes["group-title"] || "",
      id: m.name + m.location,
    }));
    filteredChannels = allChannels;
    renderList();
  }

  function renderList() {
    channelList.innerHTML = "";
    const term = searchInput.value.toLowerCase();
    const showFavs = favFilterBtn.classList.contains("active");

    filteredChannels = allChannels.filter(
      (ch) => ch.name.toLowerCase().includes(term) && (!showFavs || favorites.has(ch.id))
    );

    filteredChannels.forEach((ch) => {
      const card = document.createElement("div");
      card.className = "channel-card";
      if (activeChannelId === ch.id) card.classList.add("active");

      card.innerHTML = `
        <img src="${ch.logo || 'https://via.placeholder.com/90?text=No+Logo'}" alt="${ch.name}" class="channel-logo" />
        <div class="channel-name">${ch.name}</div>
        <div style="margin-top:5px; font-size:0.9rem; color:#888;">${ch.group}</div>
        <div style="font-size:1.2rem; margin-top:5px;">${favorites.has(ch.id) ? "★" : ""}</div>
      `;

      card.onclick = () => playChannel(ch);
      channelList.appendChild(card);
    });
  }

  function playChannel(ch) {
    activeChannelId = ch.id;
    channelName.textContent = ch.name;
    channelGroup.textContent = ch.group;
    channelLogo.src = ch.logo || "https://via.placeholder.com/120?text=No+Logo";
    favBtn.textContent = favorites.has(ch.id) ? "♥ Quitar favorito" : "♡ Agregar favorito";

    favBtn.onclick = () => {
      if (favorites.has(ch.id)) favorites.delete(ch.id);
      else favorites.add(ch.id);
      localStorage.setItem("favorites", JSON.stringify([...favorites]));
      renderList();
      favBtn.textContent = favorites.has(ch.id) ? "♥ Quitar favorito" : "♡ Agregar favorito";
    };

    if (currentHls) currentHls.destroy();

    if (videoPlayer.canPlayType("application/vnd.apple.mpegurl")) {
      videoPlayer.src = ch.url;
    } else if (Hls.isSupported()) {
      currentHls = new Hls();
      currentHls.loadSource(ch.url);
      currentHls.attachMedia(videoPlayer);
    } else {
      alert("Tu navegador no soporta HLS.");
    }

    videoPlayer.play();
    renderList();
  }
</script>

</body>
</html>
