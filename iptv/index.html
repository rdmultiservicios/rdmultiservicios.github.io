<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPTV - Diseño Moderno Tipo Movistar TV</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10"></script>
  <script src="https://cdn.jsdelivr.net/npm/m3u-parser-generator@5.0.1/dist/m3u-parser-generator.iife.js"></script>

  <style>
    body {
      background-color: #121212;
      color: #fff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-top: 70px; /* Para navbar fijo */
    }

    /* Navbar */
    .navbar-custom {
      background-color: #001f3f;
      box-shadow: 0 3px 8px rgba(0, 160, 233, 0.6);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1030;
    }
    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
      color: #00a0e9 !important;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .navbar-brand img {
      height: 32px;
    }

    /* Inputs y botones mejorados */
    input.form-control {
      border-radius: 12px;
      font-size: 1.1rem;
      padding: 12px 16px;
      background-color: #1e1e1e;
      border: 1.5px solid #444;
      color: #eee;
      box-shadow: 0 0 5px transparent;
      transition: all 0.3s ease;
    }
    input.form-control::placeholder {
      color: #888;
    }
    input.form-control:focus {
      background-color: #121212;
      border-color: #00a0e9;
      box-shadow: 0 0 10px #00a0e9;
      color: #fff;
      outline: none;
    }

    .btn-primary {
      background-color: #00a0e9;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      padding: 12px 24px;
      box-shadow: 0 0 12px #00a0e9aa;
      transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #007bbf;
      box-shadow: 0 0 20px #007bbfcc;
    }

    .btn-outline-warning {
      color: #ffc107;
      border-color: #ffc107;
      font-weight: 700;
      border-radius: 12px;
      font-size: 1.1rem;
      padding: 12px 24px;
      transition: all 0.3s ease;
    }
    .btn-outline-warning.active,
    .btn-outline-warning:hover {
      background-color: #ffc107;
      color: #121212;
      border-color: #ffc107;
      box-shadow: 0 0 20px #ffc107cc;
    }

    /* Lista de canales sin sombras */
    #channelList {
      max-height: 65vh;
      overflow-y: auto;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 15px;
    }

    .channel-card {
      background-color: #1e1e1e;
      border-radius: 12px;
      /* box-shadow eliminado */
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      cursor: pointer;
      transition: transform 0.2s ease;
      user-select: none;
    }

    .channel-card:hover {
      transform: scale(1.05);
      /* box-shadow eliminado */
    }

    .channel-card.active {
      border: 3px solid #00a0e9;
      /* box-shadow eliminado */
      transform: scale(1.1);
      background-color: #121212;
    }

    .channel-logo {
      max-width: 90px;
      max-height: 90px;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 2px #00a0e9);
    }

    .channel-name {
      font-weight: 700;
      font-size: 1rem;
      text-align: center;
      color: #e0e0e0;
      flex-grow: 1;
      user-select: none;
    }

    /* Contenedor video */
    .video-container {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.8);
      background-color: black;
    }

    video#videoPlayer {
      border-radius: 15px;
      background-color: black;
      width: 100%;
      height: 100%;
    }

    /* Info canal y botón favorito */
    #channelInfo {
      text-align: center;
      margin-top: 15px;
    }

    #channelName {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
      color: #00a0e9;
    }

    #channelGroup {
      font-style: italic;
      color: #bbb;
      margin-bottom: 10px;
    }

    #channelLogo.big {
      max-height: 120px;
      margin: 0 auto 15px;
      display: block;
      filter: drop-shadow(0 0 6px #00a0e9);
    }

    #favBtn {
      font-size: 1.3rem;
      font-weight: 700;
      padding: 10px 25px;
      border-radius: 30px;
      border: 2px solid #ffc107;
      color: #ffc107;
      background: transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
    }

    #favBtn:hover {
      background-color: #ffc107;
      color: #121212;
    }

    /* Scrollbar personalizado para canales */
    #channelList::-webkit-scrollbar {
      width: 8px;
    }
    #channelList::-webkit-scrollbar-track {
      background: #121212;
    }
    #channelList::-webkit-scrollbar-thumb {
      background-color: #00a0e9;
      border-radius: 10px;
    }

    /* Responsive */
    @media (max-width: 767.98px) {
      #channelList {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        max-height: 50vh;
        margin-bottom: 20px;
      }

      #channelName {
        font-size: 1.5rem;
      }

      #favBtn {
        width: 100%;
        padding: 12px 0;
      }
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-custom navbar-expand-lg">
  <div class="container-fluid px-4">
    <a class="navbar-brand" href="#">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Movistar_logo_2018.svg" alt="Logo Movistar" />
      IPTV Movistar TV
    </a>
  </div>
</nav>

<div class="container-fluid py-4">
  <h2>IPTV - Diseño Moderno Tipo Movistar TV</h2>

  <!-- Carga de lista -->
  <div class="row gy-3 mb-4">
    <div class="col-12 col-md-6">
      <input id="m3uInput" type="file" class="form-control" accept=".m3u,.txt" />
    </div>
    <div class="col-12 col-md-6">
      <div class="input-group">
        <input id="m3uUrl" type="url" class="form-control" placeholder="URL de lista M3U" />
        <button id="loadUrlBtn" class="btn btn-primary">Cargar</button>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="row gy-3 mb-4">
    <div class="col-12 col-md-6">
      <input id="searchInput" type="text" class="form-control" placeholder="Buscar canal..." />
    </div>
    <div class="col-12 col-md-6">
      <button id="favFilterBtn" class="btn btn-outline-warning w-100">Mostrar solo favoritos</button>
    </div>
  </div>

  <!-- Layout flexible -->
  <div class="row flex-column flex-lg-row">
    <!-- Lista de canales -->
    <div class="col-12 col-lg-4 mb-4 mb-lg-0">
      <div id="channelList"></div>
    </div>

    <!-- Reproductor y detalles -->
    <div class="col-12 col-lg-8">
      <div class="video-container ratio ratio-16x9 mb-3">
        <video id="videoPlayer" controls autoplay></video>
      </div>
      <div id="channelInfo">
        <h3 id="channelName"></h3>
        <img id="channelLogo" src="" alt="" class="big" />
        <p id="channelGroup"></p>
        <button id="favBtn">⭐ Añadir a favoritos</button>
      </div>
    </div>
  </div>
</div>

<script>
  let channels = [];
  let filteredChannels = [];
  let favorites = new Set();
  let showingFavorites = false;
  let currentChannelId = null;

  const channelListEl = document.getElementById("channelList");
  const videoPlayer = document.getElementById("videoPlayer");
  const channelNameEl = document.getElementById("channelName");
  const channelGroupEl = document.getElementById("channelGroup");
  const channelLogoEl = document.getElementById("channelLogo");
  const favBtn = document.getElementById("favBtn");

  const searchInput = document.getElementById("searchInput");
  const favFilterBtn = document.getElementById("favFilterBtn");
  const m3uInput = document.getElementById("m3uInput");
  const m3uUrl = document.getElementById("m3uUrl");
  const loadUrlBtn = document.getElementById("loadUrlBtn");

  // Carga lista desde archivo local
  m3uInput.addEventListener("change", e => {
    if(e.target.files.length === 0) return;
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      loadChannelsFromText(reader.result);
    };
    reader.readAsText(file);
  });

  // Carga lista desde URL
  loadUrlBtn.addEventListener("click", () => {
    const url = m3uUrl.value.trim();
    if(!url) return alert("Por favor, ingresa una URL válida.");
    fetch(url)
      .then(res => {
        if (!res.ok) throw new Error("No se pudo cargar la lista.");
        return res.text();
      })
      .then(text => loadChannelsFromText(text))
      .catch(err => alert(err.message));
  });

  // Parsear y cargar canales
  function loadChannelsFromText(text) {
    const parsed = M3UParserGenerator.M3U.parse(text);
    channels = parsed.items.map((item, i) => ({
      id: i,
      name: item.name || `Canal ${i + 1}`,
      url: item.url,
      group: item.group || "Sin grupo",
      logo: item.tvgLogo || "",
    }));
    filteredChannels = [...channels];
    currentChannelId = null;
    showingFavorites = false;
    favFilterBtn.classList.remove("active");
    renderChannelList();
    playChannel(channels[0]?.id);
  }

  // Renderizar lista de canales
  function renderChannelList() {
    let list = filteredChannels;
    if(showingFavorites) {
      list = list.filter(c => favorites.has(c.id));
    }

    const searchTerm = searchInput.value.trim().toLowerCase();
    if(searchTerm) {
      list = list.filter(c => c.name.toLowerCase().includes(searchTerm));
    }

    channelListEl.innerHTML = "";
    if(list.length === 0) {
      channelListEl.innerHTML = "<p class='text-center text-muted mt-3'>No se encontraron canales</p>";
      return;
    }
    for(const ch of list) {
      const card = document.createElement("div");
      card.className = "channel-card";
      if(ch.id === currentChannelId) card.classList.add("active");
      card.title = ch.name;
      card.onclick = () => playChannel(ch.id);

      const logo = document.createElement("img");
      logo.src = ch.logo || "https://via.placeholder.com/90x90?text=No+Logo";
      logo.alt = ch.name;
      logo.className = "channel-logo";

      const name = document.createElement("div");
      name.className = "channel-name";
      name.textContent = ch.name;

      card.appendChild(logo);
      card.appendChild(name);
      channelListEl.appendChild(card);
    }
  }

  // Reproducir canal
  function playChannel(id) {
    const channel = channels.find(c => c.id === id);
    if(!channel) return;

    currentChannelId = id;
    renderChannelList();

    channelNameEl.textContent = channel.name;
    channelGroupEl.textContent = channel.group;
    channelLogoEl.src = channel.logo || "https://via.placeholder.com/120x120?text=No+Logo";
    channelLogoEl.alt = channel.name;

    if(Hls.isSupported() && channel.url.endsWith(".m3u8")) {
      if(window.hls) {
        window.hls.destroy();
      }
      window.hls = new Hls();
      window.hls.loadSource(channel.url);
      window.hls.attachMedia(videoPlayer);
      window.hls.on(Hls.Events.MANIFEST_PARSED, () => {
        videoPlayer.play();
      });
    } else {
      videoPlayer.src = channel.url;
      videoPlayer.play();
    }

    updateFavButton();
  }

  // Botón favorito
  favBtn.addEventListener("click", () => {
    if(currentChannelId === null) return;
    if(favorites.has(currentChannelId)) {
      favorites.delete(currentChannelId);
    } else {
      favorites.add(currentChannelId);
    }
    updateFavButton();
  });

  // Actualizar texto y estilo del botón favorito
  function updateFavButton() {
    if(currentChannelId === null) {
      favBtn.style.display = "none";
      return;
    }
    favBtn.style.display = "inline-block";
    if(favorites.has(currentChannelId)) {
      favBtn.textContent = "⭐ Quitar de favoritos";
      favBtn.classList.add("active");
    } else {
      favBtn.textContent = "⭐ Añadir a favoritos";
      favBtn.classList.remove("active");
    }
  }

  // Filtro favoritos
  favFilterBtn.addEventListener("click", () => {
    showingFavorites = !showingFavorites;
    favFilterBtn.classList.toggle("active");
    renderChannelList();
  });

  // Filtro búsqueda
  searchInput.addEventListener("input", () => {
    renderChannelList();
  });

</script>
</body>
</html>
